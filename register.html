<!DOCTYPE html>
<html>
<head>
  <title>Register</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-4">
      <div class="card shadow">
        <div class="card-body">
          <h4 class="text-center mb-4">Register</h4>

          <div class="mb-3">
            <label>Nama Lengkap</label>
            <input type="text" id="name" class="form-control">
          </div>

          <div class="mb-3">
            <label>Username</label>
            <input type="text" id="username" class="form-control">
          </div>

          <div class="mb-3">
            <label>Password</label>
            <input type="password" id="password" class="form-control">
          </div>

          <div class="mb-3">
            <label>Confirm Password</label>
            <input type="password" id="confirmPassword" class="form-control">
          </div>

          <div id="error" class="text-danger mb-3"></div>

          <button class="btn btn-success w-100" onclick="register()">Register</button>

          <div class="text-center mt-3">
            <a href="login.html">Sudah punya akun? Login</a>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>

async function generateUID() {
  const res = await fetch("http://localhost:3000/users");
  const users = await res.json();

  if (users.length === 0) return "UID-001";

  const numbers = users.map(u => {
    if (!u.id) return 0;
    return parseInt(u.id.split("-")[1]) || 0;
  });

  const maxNumber = Math.max(...numbers);
  const nextNumber = String(maxNumber + 1).padStart(3, "0");

  return "UID-" + nextNumber;
}

async function register() {

  const name = document.getElementById("name").value.trim();
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const confirmPassword = document.getElementById("confirmPassword").value.trim();
  const errorDiv = document.getElementById("error");

  errorDiv.innerText = "";

  if (!name || !username || !password || !confirmPassword) {
    errorDiv.innerText = "Semua field wajib diisi";
    return;
  }

  if (password.length < 8) {
    errorDiv.innerText = "Password minimal 8 karakter";
    return;
  }

  if (password !== confirmPassword) {
    errorDiv.innerText = "Password tidak sama";
    return;
  }

  const res = await fetch(`http://localhost:3000/users?username=${username}`);
  const data = await res.json();

  if (data.length > 0) {
    errorDiv.innerText = "Username sudah digunakan";
    return;
  }

  const newId = await generateUID();

  await fetch("http://localhost:3000/users", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      id: newId,
      name: name,
      username: username,
      password: password,
      role: "user"
    })
  });

  alert("Register berhasil!");
  window.location.href = "login.html";
}

</script>

</body>
</html>
